!function(){"use strict";if("undefined"!=typeof jQuery){var e=jQuery.noConflict();e(document).ready(function(){var a=document.getElementById("kraken-modal");if(a){var t=document.createElement("div");t.setAttribute("id","kraken-overlay"),document.body.appendChild(t),document.body.appendChild(a.parentNode.removeChild(a)),e("#kraken-modal-close, #kraken-success-close").on("click",function(){window.location.reload()})}}),window.optimizeImages={optimize:function(a,t,n){var o=e("#kraken-modal-head").text();"media"===a?e("#kraken-modal-head").text(o.replace("__type__","media")):e("#kraken-modal-head").text(o.replace("__type__","skin")),e("#kraken-modal").show(),e("#kraken-overlay").addClass("show"),e("#kraken-total").text(n);for(var r=0,s=async.queue(function(t,o){new Ajax.Request(requestUrl,{method:"get",parameters:{type:a,image:JSON.stringify(t.file)},onComplete:function(a){r++;var t=a.responseJSON;if(t.success)s.paused||(e("#kraken-current").text(r),e("#kraken-number-progress").addClass("show").text(Math.round(r/n*100)+"%"),e("#kraken-progress-bar").css({width:Math.round(r/n*100)+"%"}));else{var d="";d=429===t.statusCode?"Unnknown API Key. Please check your Kraken API key and try again.":401===t.statusCode?"Your free quota (50 MB) has reached its limit.<br>Request more testing quota (support@kraken.io) or please upgrade to a paid plan.":t.message,(401===t.statusCode||429===t.statusCode)&&(e("#kraken-modal-error").html(t.message).show(),s.pause(),e("#kraken-modal").css({marginTop:-Math.round(e("#kraken-modal").height()/2)+"px"}))}o()}})},concurrency),d=0,i=t.length;i>d;d++)s.push({file:t[d]});s.drain=function(){setTimeout(function(){var t="";t="media"===a?"Congratulations! Your skin images have been optimized.":"Congratulations! Your media images have been optimized.",e("#kraken-modal-head").text(t),e("#kraken-success-close").show(),e("#kraken-progress").hide(),e("#kraken-modal-footer").hide(),e("#kraken-count").hide(),e("#kraken-modal-content").addClass("with-success").find("p").addClass("with-success")},500)}},optimizeCache:function(e){var a=async.queue(function(e,a){new Ajax.Request(requestUrl,{method:"post",parameters:{id:e.file.id,product_id:e.file.product_id},onComplete:function(){a()}})},cacheConcurrency);if(e.length)for(var t=0,n=e.length;n>t;t++)a.push({file:e[t]})}}}}();